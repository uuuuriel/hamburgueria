package br.com.hamburgueria.jdbc;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

import br.com.hamburgueria.exception.NoResultException;
import br.com.hamburgueria.exception.ValueZException;
import br.com.hamburgueria.jdbcinterface.UsuarioDAO;
import br.com.hamburgueria.objs.Usuario;

public class JDBCUsuarioDAO implements UsuarioDAO {
	private Connection conexao;

	public JDBCUsuarioDAO(Connection conexao) {
		this.conexao = conexao;
	}

	public List<Usuario> buscarPorNome(String nome) throws NoResultException  {
		String comando = "select * from cliente  ";
		if (!nome.equals("")) {
			comando += "where nomecliente like '" + nome + "%'";
		}
		List<Usuario> list = new ArrayList<Usuario>();
		Usuario user = null;
		try {
			java.sql.Statement stmt = conexao.createStatement();
			ResultSet rs = stmt.executeQuery(comando);
			while (rs.next()) {
				user = new Usuario();
				user.setAtivo(rs.getInt("ativo"));
				user.setBairro(rs.getInt("bairro"));
				user.setCidade(rs.getInt("cidade"));
				user.setCod(rs.getInt("codcliente"));
				user.setComplemento(rs.getString("complemento"));
				user.setCpf(rs.getInt("cpf"));
				user.setData_nascimento(rs.getDate("data_nascimento"));
				user.setEmail(rs.getString("email"));
				user.setNome(rs.getString("nomecliente"));
				user.setNumero(rs.getInt("numero"));
				user.setRg(rs.getInt("rg"));
				user.setRua(rs.getString("rua"));
				user.setSenha(rs.getString("senha"));
				user.setTelefone(rs.getDouble("fone"));
				user.setCep(rs.getInt("cep"));
				list.add(user);
			}
			if(list.isEmpty()){
				throw new NoResultException();
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return list;
	}

	@Override
	public boolean deletarUsuario(int cod) throws NoResultException{
		if(cod == 0){
			throw new NoResultException("Erro ao deletar Usuario");
		}
		String comando = "delete from cliente where codcliente = "
				+ cod;
		Statement p;
		try {
			p = this.conexao.createStatement();
			p.execute(comando);
		} catch (SQLException e) {
			e.printStackTrace();
			return false;
		}
		return true;
	}

	@Override
	public boolean atualizar(Usuario user) throws ValueZException{
		if(user == null){
			throw new ValueZException("Erro ao atualizar os dados do Usuário");
		}
		boolean editSenha = false;
		String comando = "UPDATE cliente SET nomecliente=?, data_nascimento=?, rg=?, cpf=?,"
				+ "cidade=?, bairro=?, rua=?, numero=?, complemento=?, cep=?, telefone=?, email=?,"
				+ "senha=? ";
		if (user.getSenha() == null || user.getSenha().isEmpty()) {
			comando += " WHERE codcliente = ";
		} else {
			editSenha = true;
			comando += ", senha=? where codcliente = ";
		}
		comando += user.getCod();
		PreparedStatement p;
		try {
			p = this.conexao.prepareStatement(comando);
			p.setString(1, user.getNome());
			p.setDate(2, new java.sql.Date(user.getData_nascimento().getTime()));
			p.setInt(3, user.getRg());
			p.setDate(4, new java.sql.Date(user.getData_nascimento().getTime()));
			p.setDouble(5, func.getFone());
			p.setString(6, func.getEmail());
			p.setString(7, func.getFuncao());
			p.setString(8, func.getCidade());
			p.setString(9, func.getBairro());
			p.setFloat(10, func.getNumero());
			p.setString(11, func.getRua());
			p.setString(12, func.getComplemento());
			p.setInt(13, func.getAdministrador());
			p.setInt(14, func.getCep());
			if (editSenha) {
				p.setString(15, user.getSenha());
			};
			p.executeUpdate();

		} catch (SQLException e) {
			e.printStackTrace();
			return false;
		}
		return true;
	}

	@Override
	public boolean inserir(Funcionario func) throws ValueZException {
		if(func == null){
			throw new ValueZException("Algo errado com Funcionário.");
		}
		String comando = "insert into funcionario (nomefuncionario, cpf, rg"
				+ ", data_nascimento, fone, email, senha, funcao, cidade, bairro"
				+ ",numero, rua, complemento, administrador, cep) "
				+ "values (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
		PreparedStatement p;
		try {
			p = this.conexao.prepareStatement(comando);
			p.setString(1, func.getNomeFuncionario());
			p.setString(2, func.getCpf());
			p.setString(3, func.getRg());
			p.setDate(4, new java.sql.Date(func.getDataNascimento().getTime()));
			p.setDouble(5, func.getFone());
			p.setString(6, func.getEmail());
			p.setString(7, func.getSenha());
			p.setString(8, func.getFuncao());
			p.setString(9, func.getCidade());
			p.setString(10, func.getBairro());
			p.setFloat(11, func.getNumero());
			p.setString(12, func.getRua());
			p.setString(13, func.getComplemento());
			p.setInt(14, func.getAdministrador());
			p.setInt(15, func.getCep());

			p.execute();
		} catch (SQLException e) {
			e.printStackTrace();
			return false;
		}
		return true;
	}

	public Funcionario buscarPorId(int cod) throws NoResultException {
		String comando = "select * from funcionario where codfuncionario = "
				+ cod;
		Funcionario func = null;
		try {
			java.sql.Statement stmt = conexao.createStatement();
			ResultSet rs = stmt.executeQuery(comando);
			while (rs.next()) {
				func = new Funcionario();
				func.setAdministrador(rs.getInt("administrador"));
				func.setBairro(rs.getString("bairro"));
				func.setCidade(rs.getString("cidade"));
				func.setCodfuncionario(rs.getInt("codfuncionario"));
				func.setComplemento(rs.getString("complemento"));
				func.setCpf(rs.getString("cpf"));
				func.setDataNascimento(rs.getDate("data_nascimento"));
				func.setEmail(rs.getString("email"));
				func.setNomeFuncionario(rs.getString("nomefuncionario"));
				func.setNumero(rs.getInt("numero"));
				func.setRg(rs.getString("rg"));
				func.setRua(rs.getString("rua"));
				func.setFuncao(rs.getString("funcao"));
				func.setSenha(rs.getString("senha"));
				func.setFone(rs.getDouble("fone"));
				func.setCep(rs.getInt("cep"));
			}
			if(func == null){
				throw new NoResultException();
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return func;
	}
}
